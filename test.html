<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SuperParticles - Comprehensive Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        .test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            background: #2a2a2a;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #70c1ff;
        }
        .test-status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 14px;
        }
        .status-pass { background: #2d5a2d; color: #90ee90; }
        .status-fail { background: #5a2d2d; color: #ff6b6b; }
        .status-info { background: #2d4a5a; color: #87ceeb; }
        canvas {
            border: 1px solid #444;
            border-radius: 4px;
            width: 100%;
            height: 200px;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            background: #70c1ff;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
        }
        button:hover { background: #5ba8e8; }
        .performance-info {
            font-family: monospace;
            font-size: 12px;
            background: #333;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>SuperParticles - Comprehensive Test Suite</h1>
    
    <div class="test-container">
        <!-- Auto-Detection Test -->
        <div class="test-section">
            <div class="test-title">üîç Auto-Detection Test</div>
            <div id="auto-detection-status"></div>
            <canvas id="auto-canvas"></canvas>
            <div class="performance-info" id="auto-performance"></div>
        </div>

        <!-- WebGL2 Test -->
        <div class="test-section">
            <div class="test-title">üéÆ WebGL2 Renderer Test</div>
            <div id="webgl-status"></div>
            <canvas id="webgl-canvas"></canvas>
            <div class="performance-info" id="webgl-performance"></div>
        </div>

        <!-- Canvas2D Test -->
        <div class="test-section">
            <div class="test-title">üé® Canvas2D Renderer Test</div>
            <div id="canvas-status"></div>
            <canvas id="canvas-canvas"></canvas>
            <div class="performance-info" id="canvas-performance"></div>
        </div>

        <!-- Performance Test -->
        <div class="test-section">
            <div class="test-title">‚ö° Performance Test (100k particles)</div>
            <div id="perf-status"></div>
            <canvas id="perf-canvas"></canvas>
            <div class="performance-info" id="perf-performance"></div>
        </div>
    </div>

    <!-- Test Results Summary -->
    <div class="test-section">
        <div class="test-title">üìä Test Results Summary</div>
        <div id="test-summary"></div>
    </div>

    <script type="module">
        import { init } from './dist/index.js';

        let testResults = {
            autoDetection: false,
            webgl2Support: false,
            canvas2DSupport: false,
            performanceTest: false,
            bundleSize: false
        };

        // Test 1: Auto-Detection
        async function testAutoDetection() {
            const canvas = document.getElementById('auto-canvas');
            const status = document.getElementById('auto-detection-status');
            const perf = document.getElementById('auto-performance');
            
            try {
                const strongGPU = !!canvas.getContext('webgl2') && navigator.hardwareConcurrency > 4;
                status.innerHTML = `<div class="test-status status-info">Auto-detecting renderer...</div>`;
                
                const startTime = performance.now();
                const renderer = await init(canvas, { useWebGL: strongGPU });
                const loadTime = performance.now() - startTime;
                
                const rendererType = strongGPU ? 'WebGL2' : 'Canvas2D';
                status.innerHTML = `
                    <div class="test-status status-pass">‚úÖ Auto-detection working</div>
                    <div class="test-status status-info">Selected: ${rendererType}</div>
                    <div class="test-status status-info">Load time: ${loadTime.toFixed(2)}ms</div>
                `;
                
                perf.innerHTML = `
                    WebGL2 Support: ${!!canvas.getContext('webgl2')}<br>
                    CPU Cores: ${navigator.hardwareConcurrency}<br>
                    Device Memory: ${navigator.deviceMemory || 'Unknown'}GB<br>
                    User Agent: ${navigator.userAgent.substring(0, 50)}...
                `;
                
                testResults.autoDetection = true;
                return renderer;
            } catch (error) {
                status.innerHTML = `<div class="test-status status-fail">‚ùå Auto-detection failed: ${error.message}</div>`;
                return null;
            }
        }

        // Test 2: WebGL2 Renderer
        async function testWebGL2() {
            const canvas = document.getElementById('webgl-canvas');
            const status = document.getElementById('webgl-status');
            const perf = document.getElementById('webgl-performance');
            
            try {
                if (!canvas.getContext('webgl2')) {
                    status.innerHTML = `<div class="test-status status-fail">‚ùå WebGL2 not supported</div>`;
                    return null;
                }
                
                status.innerHTML = `<div class="test-status status-info">Testing WebGL2...</div>`;
                const renderer = await init(canvas, { useWebGL: true });
                
                status.innerHTML = `<div class="test-status status-pass">‚úÖ WebGL2 working</div>`;
                perf.innerHTML = `
                    WebGL2: Supported<br>
                    Canvas Size: ${canvas.width}x${canvas.height}<br>
                    Device Pixel Ratio: ${devicePixelRatio || 1}
                `;
                
                testResults.webgl2Support = true;
                return renderer;
            } catch (error) {
                status.innerHTML = `<div class="test-status status-fail">‚ùå WebGL2 failed: ${error.message}</div>`;
                return null;
            }
        }

        // Test 3: Canvas2D Renderer
        async function testCanvas2D() {
            const canvas = document.getElementById('canvas-canvas');
            const status = document.getElementById('canvas-status');
            const perf = document.getElementById('canvas-performance');
            
            try {
                status.innerHTML = `<div class="test-status status-info">Testing Canvas2D...</div>`;
                const renderer = await init(canvas, { useWebGL: false });
                
                status.innerHTML = `<div class="test-status status-pass">‚úÖ Canvas2D working</div>`;
                perf.innerHTML = `
                    Canvas2D: Supported<br>
                    Canvas Size: ${canvas.width}x${canvas.height}<br>
                    Device Pixel Ratio: ${devicePixelRatio || 1}
                `;
                
                testResults.canvas2DSupport = true;
                return renderer;
            } catch (error) {
                status.innerHTML = `<div class="test-status status-fail">‚ùå Canvas2D failed: ${error.message}</div>`;
                return null;
            }
        }

        // Test 4: Performance Test
        async function testPerformance() {
            const canvas = document.getElementById('perf-canvas');
            const status = document.getElementById('perf-status');
            const perf = document.getElementById('perf-performance');
            
            try {
                const strongGPU = !!canvas.getContext('webgl2') && navigator.hardwareConcurrency > 4;
                status.innerHTML = `<div class="test-status status-info">Testing 100k particles...</div>`;
                
                const startTime = performance.now();
                const renderer = await init(canvas, { useWebGL: strongGPU });
                const loadTime = performance.now() - startTime;
                
                // Monitor FPS for 5 seconds
                let frameCount = 0;
                let lastTime = performance.now();
                const fpsInterval = setInterval(() => {
                    frameCount++;
                    const currentTime = performance.now();
                    if (currentTime - lastTime >= 1000) {
                        const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                        perf.innerHTML = `
                            Load Time: ${loadTime.toFixed(2)}ms<br>
                            Current FPS: ${fps}<br>
                            Renderer: ${strongGPU ? 'WebGL2' : 'Canvas2D'}<br>
                            Particles: 100,000
                        `;
                        
                        if (fps >= 50) {
                            status.innerHTML = `<div class="test-status status-pass">‚úÖ Performance OK (${fps} FPS)</div>`;
                            testResults.performanceTest = true;
                        } else {
                            status.innerHTML = `<div class="test-status status-fail">‚ö†Ô∏è Performance poor (${fps} FPS)</div>`;
                        }
                        
                        clearInterval(fpsInterval);
                    }
                }, 16);
                
                return renderer;
            } catch (error) {
                status.innerHTML = `<div class="test-status status-fail">‚ùå Performance test failed: ${error.message}</div>`;
                return null;
            }
        }

        // Test 5: Bundle Size Check
        async function testBundleSize() {
            try {
                const response = await fetch('./dist/index.js');
                const bundleSize = response.headers.get('content-length');
                const sizeKB = Math.round(bundleSize / 1024);
                
                if (sizeKB <= 2) { // Should be under 2KB
                    testResults.bundleSize = true;
                    return `‚úÖ Bundle size: ${sizeKB}KB (under 2KB target)`;
                } else {
                    return `‚ö†Ô∏è Bundle size: ${sizeKB}KB (over 2KB target)`;
                }
            } catch (error) {
                return `‚ùå Bundle size check failed: ${error.message}`;
            }
        }

        // Run all tests
        async function runAllTests() {
            console.log('üß™ Starting SuperParticles comprehensive test...');
            
            // Run tests in parallel
            const [autoRenderer, webglRenderer, canvasRenderer, perfRenderer] = await Promise.all([
                testAutoDetection(),
                testWebGL2(),
                testCanvas2D(),
                testPerformance()
            ]);
            
            // Check bundle size
            const bundleResult = await testBundleSize();
            
            // Update summary
            const summary = document.getElementById('test-summary');
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const totalTests = Object.keys(testResults).length;
            
            summary.innerHTML = `
                <div class="test-status ${passedTests === totalTests ? 'status-pass' : 'status-fail'}">
                    ${passedTests}/${totalTests} tests passed
                </div>
                <div class="test-status status-info">${bundleResult}</div>
                <div class="test-status status-info">
                    Auto-Detection: ${testResults.autoDetection ? '‚úÖ' : '‚ùå'}<br>
                    WebGL2 Support: ${testResults.webgl2Support ? '‚úÖ' : '‚ùå'}<br>
                    Canvas2D Support: ${testResults.canvas2DSupport ? '‚úÖ' : '‚ùå'}<br>
                    Performance Test: ${testResults.performanceTest ? '‚úÖ' : '‚ùå'}<br>
                    Bundle Size: ${testResults.bundleSize ? '‚úÖ' : '‚ùå'}
                </div>
            `;
            
            console.log('üß™ Test complete!', testResults);
        }

        // Start tests when page loads
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html> 